{% extends 'base_lk.html' %}

{% block Header %}
    {% include '/headers/profile.html' %}
{% endblock %}

{% block Body %}
<section class="main-section">
    <div class="container">
        <form class="main-inner" method="POST">
            {{ form.hidden_tag() }}
            <div class="title">
                Платеж
            </div>
            <div class="push60 hidden-xss"></div>
            <div class="push40 visible-xss"></div>
            <div class="code-wrapper">
                <div class="form-group">
                    {{ form.address.label(class="label", for="address")}}
                    {{ form.address(class="form-control select-styler", id="address", list="address-list")}}
                    <datalist id="address-list">
                        {% for address in address_list %}
                            <option id="{{address[0]}}">{{address[1]}}</option>
                        {% endfor %}
                    </datalist>
                </div>
                <div class="form-group">
                    {{ form.apartment.label(class="label", for="apartment") }}
                    {{ form.apartment(class="form-control select-styler", id="apartment", list="apartment-list") }}
                    <datalist id="apartment-list">
                        {% for apartment in apartment_list %}
                            <option id="{{ apartment[0] }}">{{ apartment[1] }}</option>
                        {% endfor %}
                    </datalist>
                </div>
                <div class="form-group">
                    {{ form.tariff.label(class="label", for="tariff") }}
                    {{ form.tariff(type="number", class="form-control", id="tariff") }}
                </div>
                <div class="form-group">
                    {{ form.amount.label(class="label", for="amount") }}
                    {{ form.amount(type="number", class="form-control", id="amount") }}
                </div>
            </div>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="label" style="color:gray">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <div class="push20 hidden-xss"></div>
            <div class="push20 visible-xss"></div>
            {{ form.submit(class="button") }}
            <div class="push100 hidden-xss"></div>
            <div class="push50 visible-xss"></div> 
        </form>	
    </div>
</section>
{% endblock %}

{% block Scripts %}
<script>
    const addressElement = document.getElementById("address");
    const apartmentElementList = document.getElementById("apartment-list");
    const apartment_url = document.location.protocol + '//' + document.location.host + '/operator/apartment/'; 

    addressElement.addEventListener("input", function (event){
        let data = this.value;

        $.ajax({
            async: true,
            method: 'POST',
            url: apartment_url,
            dataType: 'text',
            data: data,
            success: function (data) {
                data = JSON.parse(data);
                $("#apartment-list").empty();
                for (let i = 0; i < data.length; i++) {
                    let newOption = new Option(data[i][1]);
                    apartmentElementList.append(newOption);
                }
            },
            error: function (data) {
                console.log(data);
            }
        });
    });
</script>
{% endblock %}